<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>QR Code Scanner ‚Äî Camera or Image | GoToolOnline</title>
<meta name="description" content="Scan QR codes using your camera or upload an image. Works locally in your browser. No uploads."/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'><text x='2' y='14' font-size='14'>üì∑</text></svg>"/>
<style>
  :root{--bg:#0a0f1e;--card:#0f1830;--fg:#eaf3ff;--muted:#9fb0c3;--acc:#4fb3ff;--ok:#61d095;--warn:#ffb86b}
  *{box-sizing:border-box} body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--fg)}
  header{max-width:1000px;margin:18px auto 8px;display:flex;gap:10px;align-items:center;padding:0 16px}
  header a{color:var(--fg);text-decoration:none}
  .pill{padding:8px 12px;border:1px solid #24365b;background:#0f1a2f;border-radius:999px}
  select.lang{margin-left:auto;padding:8px 12px;background:#0f1a2f;border:1px solid #24365b;border-radius:12px;color:#eaf3ff}
  main{max-width:1000px;margin:8px auto 72px;padding:0 16px}
  .card{background:#0f1830;border:1px solid #1a2843;border-radius:18px;padding:16px;margin:12px 0}
  video{width:100%;border-radius:12px;border:1px solid #223055;background:#000}
  canvas{display:none}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  input,button,select{padding:12px;border-radius:12px;border:1px solid #24365b;background:#0f1a2f;color:#eaf3ff;font-size:16px}
  button{cursor:pointer;font-weight:800}
  button.primary{background:linear-gradient(180deg,#2a78ff,#0050d4);border:none}
  button.ghost{background:#0f1a2f}
  .mono{font-family:ui-monospace, Menlo, Consolas, monospace}
  .muted{color:var(--muted)}
  .ok{color:var(--ok)} .warn{color:var(--warn)}
  #box{position:relative}
  #overlay{position:absolute;inset:0;border:2px dashed rgba(79,179,255,.3);border-radius:12px;pointer-events:none}
  #bbox{position:absolute;inset:0;pointer-events:none}
  .note{font-size:14px;color:#9fb0c3}
  @media print{ header, .web-only{display:none!important} body{background:#fff;color:#000} .card{border:none} }
</style>

  
  <link rel="alternate" hreflang="en" href="https://gotoolonline.com/tools/qr-code-scanner/"/>
  <link rel="alternate" hreflang="x-default" href="https://gotoolonline.com/tools/qr-code-scanner/"/>

<link rel="canonical" href="https://gotoolonline.com/tools/qr-code-scanner/">
</head>
\1

    <div id="topnav-return-home" style="position:sticky;top:0;padding:10px 14px;border-bottom:1px solid #eee;background:#fff;z-index:999;font-family:system-ui,Segoe UI,Roboto,Arial;">
      <a href="../../index.html" style="text-decoration:none;">‚Üê ËøîÂõûÈ¶ñÈ°µ</a>
    </div>
    
<header>
  <a class="pill" data-home href="#">üõ† GoToolOnline</a>
  <a class="pill" data-home href="#" id="back">‚Üê Back to Home</a>
  <select id="lang" class="lang" aria-label="Language">
    <option value="en">English</option>
    <option value="zh">ÁÆÄ‰Ωì‰∏≠Êñá</option>
    <option value="ph">Tagalog</option>
    <option value="id">Bahasa Indonesia</option>
    <option value="vi">Ti·∫øng Vi·ªát</option>
    <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</option>
    <option value="ng">English (NG)</option>
    <option value="sw">Kiswahili</option>
    <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
  </select>
</header>
<main>
<section class="card">
  <h1 id="title">QR Code Scanner</h1>
  <p class="muted" id="subtitle">Local-only scanning. Nothing leaves your browser.</p>

  <div class="row" style="margin:8px 0">
    <button class="primary" id="start">Start Camera</button>
    <button class="ghost" id="stop">Stop</button>
    <select id="cams" title="Camera"></select>
    <button class="ghost" id="torch" disabled>üî¶ Torch</button>
    <input id="file" type="file" accept="image/*"/>
  </div>

  <div id="box">
    <video id="v" muted playsinline></video>
    <canvas id="bbox"></canvas>
    <div id="overlay"></div>
  </div>

  <div class="card">
    <h3 style="margin:0 0 8px" id="resTitle">Result</h3>
    <div class="mono" id="result">‚Äî</div>
    <div class="row" style="margin-top:8px">
      <button id="copy">Copy</button>
      <a class="pill" id="open" href="#" target="_blank" rel="noopener">Open as URL</a>
      <span class="note" id="status"></span>
    </div>
    <div class="muted" id="note" style="margin-top:6px"></div>
  </div>
</section>
</main>

<script>
  // ---------- i18n (9 languages) ----------
  const I18N = {
    en:{title:"QR Code Scanner", sub:"Local-only scanning. Nothing leaves your browser.",
        start:"Start Camera", stop:"Stop", torch:"Torch", result:"Result",
        copy:"Copy", open:"Open as URL", needPerm:"Camera access denied or unavailable.",
        nobs:"BarcodeDetector not supported. Falling back to local decoder (jsQR).",
        noqr:"No QR found.", ready:"Ready.", copied:"Copied.", copyfail:"Copy not supported.",
        cam:"Camera"},
    zh:{title:"‰∫åÁª¥Á†ÅÊâ´ÊèèÂô®", sub:"Êú¨Âú∞Ëß£ÊûêÔºå‰∏ç‰∏ä‰º†Âà∞ÊúçÂä°Âô®„ÄÇ",
        start:"ÂêØÂä®Áõ∏Êú∫", stop:"ÂÅúÊ≠¢", torch:"ÊâãÁîµÁ≠í", result:"ÁªìÊûú",
        copy:"Â§çÂà∂", open:"Â∞ùËØï‰Ωú‰∏∫ÈìæÊé•ÊâìÂºÄ", needPerm:"Êó†Ê≥ïËÆøÈóÆÁõ∏Êú∫ÊàñÂ∑≤Ë¢´ÊãíÁªù„ÄÇ",
        nobs:"ÊµèËßàÂô®‰∏çÊîØÊåÅ BarcodeDetectorÔºåÂ∑≤ÂõûÈÄÄÂà∞Êú¨Âú∞Ëß£Á†ÅÔºàjsQRÔºâ„ÄÇ",
        noqr:"Êú™Ê£ÄÊµãÂà∞‰∫åÁª¥Á†Å„ÄÇ", ready:"Â∞±Áª™„ÄÇ", copied:"Â∑≤Â§çÂà∂„ÄÇ", copyfail:"‰∏çÊîØÊåÅÂ§çÂà∂„ÄÇ",
        cam:"ÊëÑÂÉèÂ§¥"},
    ph:{title:"QR Code Scanner", sub:"Lokal lang ang pag-scan. Walang upload.",
        start:"Simulan ang Camera", stop:"Itigil", torch:"Ilaw", result:"Resulta",
        copy:"Kopya", open:"Buksan bilang URL", needPerm:"Hindi ma-access ang camera.",
        nobs:"Walang BarcodeDetector. Gagamit ng lokal na jsQR.", noqr:"Walang QR na nahanap.",
        ready:"Handa.", copied:"Nakopya.", copyfail:"Hindi suportado ang kopya.",
        cam:"Kamera"},
    id:{title:"Pemindai Kode QR", sub:"Pemindaian lokal saja. Tidak ada unggahan.",
        start:"Mulai Kamera", stop:"Hentikan", torch:"Senter", result:"Hasil",
        copy:"Salin", open:"Buka sebagai URL", needPerm:"Akses kamera ditolak/tidak ada.",
        nobs:"BarcodeDetector tidak didukung. Pakai decoder lokal (jsQR).",
        noqr:"QR tidak ditemukan.", ready:"Siap.", copied:"Tersalin.", copyfail:"Salin tidak didukung.",
        cam:"Kamera"},
    vi:{title:"Tr√¨nh qu√©t m√£ QR", sub:"Qu√©t c·ª•c b·ªô. Kh√¥ng t·∫£i l√™n.",
        start:"B·∫≠t m√°y ·∫£nh", stop:"D·ª´ng", torch:"ƒê√®n", result:"K·∫øt qu·∫£",
        copy:"Sao ch√©p", open:"M·ªü nh∆∞ URL", needPerm:"Kh√¥ng th·ªÉ truy c·∫≠p camera.",
        nobs:"Kh√¥ng h·ªó tr·ª£ BarcodeDetector. D√πng jsQR c·ª•c b·ªô.", noqr:"Kh√¥ng t√¨m th·∫•y m√£ QR.",
        ready:"S·∫µn s√†ng.", copied:"ƒê√£ sao ch√©p.", copyfail:"Kh√¥ng h·ªó tr·ª£ sao ch√©p.",
        cam:"M√°y ·∫£nh"},
    bn:{title:"‡¶ï‡¶ø‡¶â‡¶Ü‡¶∞ ‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞", sub:"‡¶≤‡ßã‡¶ï‡¶æ‡¶≤‡ßá‡¶á ‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶® ‡¶π‡ßü, ‡¶ï‡ßã‡¶® ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶®‡ßü‡•§",
        start:"‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶ö‡¶æ‡¶≤‡ßÅ", stop:"‡¶•‡¶æ‡¶Æ‡¶æ‡¶®", torch:"‡¶ü‡¶∞‡ßç‡¶ö", result:"‡¶´‡¶≤‡¶æ‡¶´‡¶≤",
        copy:"‡¶ï‡¶™‡¶ø", open:"URL ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶ñ‡ßÅ‡¶≤‡ßÅ‡¶®", needPerm:"‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø ‡¶¨‡¶æ ‡¶Ö‡¶®‡ßÅ‡¶Æ‡¶§‡¶ø ‡¶®‡ßá‡¶á‡•§",
        nobs:"BarcodeDetector ‡¶®‡ßá‡¶á‡•§ ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ jsQR ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶π‡¶ö‡ßç‡¶õ‡ßá‡•§",
        noqr:"‡¶ï‡ßã‡¶®‡ßã ‡¶ï‡¶ø‡¶â‡¶Ü‡¶∞ ‡¶Æ‡ßá‡¶≤‡ßá‡¶®‡¶ø‡•§", ready:"‡¶∞‡ßá‡¶°‡¶ø‡•§", copied:"‡¶ï‡¶™‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§", copyfail:"‡¶ï‡¶™‡¶ø ‡¶∏‡¶Æ‡¶∞‡ßç‡¶•‡¶ø‡¶§ ‡¶®‡ßü‡•§",
        cam:"‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ"},
    ng:{title:"QR Code Scanner", sub:"Local scanning only. No uploads.",
        start:"Start Camera", stop:"Stop", torch:"Torch", result:"Result",
        copy:"Copy", open:"Open as URL", needPerm:"Camera access denied/unavailable.",
        nobs:"BarcodeDetector not supported. Using local jsQR.",
        noqr:"No QR found.", ready:"Ready.", copied:"Copied.", copyfail:"Copy not supported.",
        cam:"Camera"},
    sw:{title:"Kichanganuzi cha QR", sub:"Uchakataji wa ndani pekee. Hakuna upakiaji.",
        start:"Washa Kamera", stop:"Simamisha", torch:"Taa", result:"Matokeo",
        copy:"Nakili", open:"Fungua kama URL", needPerm:"Kamera haipatikani/imekataliwa.",
        nobs:"Hakuna BarcodeDetector. Kutumia jsQR ya ndani.",
        noqr:"Hakuna QR iliyopatikana.", ready:"Tayari.", copied:"Imenakiliwa.", copyfail:"Kunakili hakusaidiwi.",
        cam:"Kamera"},
    ar:{title:"ŸÇÿßÿ±ÿ¶ ÿ±ŸÖÿ≤ QR", sub:"ÿßŸÑŸÖÿ≥ÿ≠ ŸÖÿ≠ŸÑŸä ŸÅŸÇÿ∑. ŸÑÿß Ÿäÿ™ŸÖ ÿßŸÑÿ±ŸÅÿπ.",
        start:"ÿ®ÿØÿ° ÿßŸÑŸÉÿßŸÖŸäÿ±ÿß", stop:"ÿ•ŸäŸÇÿßŸÅ", torch:"ŸÖÿµÿ®ÿßÿ≠", result:"ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ©",
        copy:"ŸÜÿ≥ÿÆ", open:"ŸÅÿ™ÿ≠ ŸÉÿ±ÿßÿ®ÿ∑", needPerm:"ŸÑÿß ŸäŸÖŸÉŸÜ ÿßŸÑŸàÿµŸàŸÑ ŸÑŸÑŸÉÿßŸÖŸäÿ±ÿß.",
        nobs:"BarcodeDetector ÿ∫Ÿäÿ± ŸÖÿØÿπŸàŸÖ. ÿ≥Ÿäÿ™ŸÖ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ jsQR ŸÖÿ≠ŸÑŸäÿßŸã.",
        noqr:"ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿ±ŸÖÿ≤ QR.", ready:"ÿ¨ÿßŸáÿ≤.", copied:"ÿ™ŸÖ ÿßŸÑŸÜÿ≥ÿÆ.", copyfail:"ÿßŸÑŸÜÿ≥ÿÆ ÿ∫Ÿäÿ± ŸÖÿØÿπŸàŸÖ.",
        cam:"ÿßŸÑŸÉÿßŸÖŸäÿ±ÿß"}
  };
  const HTML_LANG = {en:'en', zh:'zh-CN', ph:'tl-PH', id:'id-ID', vi:'vi-VN', bn:'bn', ng:'en-NG', sw:'sw', ar:'ar'};
  const qs = new URLSearchParams(location.search);

  function setHomeLinksForLang(lang){
    var path = location.pathname.replace(/\/+$/,''); var parts = path.split('/');
    parts = (parts.length>=3) ? parts.slice(0, parts.length-2) : [''];
    var home = parts.join('/') + '/';
    const u = new URL(home, location.origin); u.searchParams.set('lang', lang);
    document.querySelectorAll('a[data-home]').forEach(a=>a.setAttribute('href', u.pathname+u.search+u.hash));
  }
  function applyLang(lang){
    const t = I18N[lang]||I18N.en;
    document.title = t.title + " | GoToolOnline";
    document.documentElement.lang = HTML_LANG[lang]||'en';
    document.documentElement.dir = (lang==='ar') ? 'rtl' : 'ltr';
    document.getElementById('back').textContent = "‚Üê " + (t.back || "Back to Home");
    document.getElementById('title').textContent = t.title;
    document.getElementById('subtitle').textContent = t.sub;
    document.getElementById('start').textContent = t.start;
    document.getElementById('stop').textContent  = t.stop;
    document.getElementById('torch').textContent = 'üî¶ ' + t.torch;
    document.getElementById('resTitle').textContent = t.result;
    document.getElementById('copy').textContent = t.copy;
    document.getElementById('open').textContent = t.open;
    document.getElementById('cams').title = t.cam;
    localStorage.setItem('lang', lang); qs.set('lang', lang);
    history.replaceState({}, '', location.pathname + '?' + qs.toString());
    setHomeLinksForLang(lang);
  }
  (function bootLang(){
    const L = qs.get('lang') || localStorage.getItem('lang') || 'en';
    const sel = document.getElementById('lang'); sel.value = I18N[L]?L:'en';
    applyLang(sel.value); sel.addEventListener('change', e=> applyLang(e.target.value));
  })();

  // ---------- Scanner ----------
  const hasBD = 'BarcodeDetector' in window;
  let det = null, stream=null, raf=0, lastVal='', lastTs=0, usingJsQR=false, jsqrReady=false, curTrack=null, torchOn=false;
  const v = document.getElementById('v'); const res = document.getElementById('result'); const note = document.getElementById('note');
  const statusEl = document.getElementById('status'); const bbox = document.getElementById('bbox'); const ctx = bbox.getContext('2d');

  if (hasBD){
    try{ det = new BarcodeDetector({formats:['qr_code']}); }catch(e){ det = new BarcodeDetector(); }
  } else {
    usingJsQR = true;
    note.textContent = (I18N[document.getElementById('lang').value]||I18N.en).nobs;
  }

  async function ensureJsQR(){
    if (jsqrReady) return true;
    return new Promise((resolve,reject)=>{
      const s = document.createElement('script');
      s.src = 'https://unpkg.com/jsqr@1.4.0/dist/jsQR.min.js'; s.async = true;
      s.onload = ()=>{ jsqrReady = !!window.jsQR; resolve(jsqrReady); };
      s.onerror = ()=> reject(new Error('jsQR load fail'));
      document.head.appendChild(s);
    });
  }

  function beep(){
    try{
      const ctx = new (window.AudioContext||window.webkitAudioContext)();
      const o = ctx.createOscillator(), g = ctx.createGain();
      o.type='sine'; o.frequency.value=880; o.connect(g); g.connect(ctx.destination);
      g.gain.setValueAtTime(0.001, ctx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.3, ctx.currentTime+0.01);
      o.start(); g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime+0.2); o.stop(ctx.currentTime+0.22);
    }catch{}
  }

  function looksLikeURL(s){
    return /^([a-z][a-z0-9+.-]*:)?\/\//i.test(s) || /^https?:/i.test(s);
  }

  function showResult(text){
    const lang = document.getElementById('lang').value; const t = I18N[lang]||I18N.en;
    res.textContent = text || '‚Äî';
    const open = document.getElementById('open');
    if (text && looksLikeURL(text)){ open.href = text; open.classList.remove('disabled'); }
    else { open.href = '#'; }
    statusEl.textContent = t.ready;
  }

  function drawBox(points,color='#4fb3ff'){
    ctx.clearRect(0,0,bbox.width,bbox.height);
    if (!points || points.length<4) return;
    ctx.lineWidth = 3; ctx.strokeStyle = color; ctx.beginPath();
    ctx.moveTo(points[0].x, points[0].y);
    for (let i=1;i<points.length;i++) ctx.lineTo(points[i].x, points[i].y);
    ctx.closePath(); ctx.stroke();
  }

  async function listCams(){
    const sel = document.getElementById('cams'); sel.innerHTML='';
    try{
      const devs = (await navigator.mediaDevices.enumerateDevices()).filter(d=>d.kind==='videoinput');
      devs.forEach((d,i)=>{
        const opt = document.createElement('option');
        opt.value = d.deviceId; opt.textContent = d.label || `Camera ${i+1}`;
        sel.appendChild(opt);
      });
      return devs;
    }catch{ return []; }
  }

  async function startCam(){
    stopCam();
    const lang = document.getElementById('lang').value; const t = I18N[lang]||I18N.en;
    const devs = await listCams();
    const want = document.getElementById('cams').value || (devs.find(d=>/back|rear|environment/i.test(d.label||''))?.deviceId || (devs[0]?.deviceId||null));
    try{
      stream = await navigator.mediaDevices.getUserMedia({video: want ? {deviceId:{exact:want}} : {facingMode:'environment'}});
      v.srcObject = stream; await v.play();
      curTrack = stream.getVideoTracks()[0];
      document.getElementById('torch').disabled = !(curTrack && curTrack.getCapabilities && curTrack.getCapabilities().torch);
      bbox.width = v.videoWidth; bbox.height = v.videoHeight;
      if (usingJsQR){
        await ensureJsQR();
        scanLoopJsQR();
      } else {
        scanLoopBD();
      }
    }catch(e){
      alert(t.needPerm);
    }
  }

  function stopCam(){
    cancelAnimationFrame(raf);
    if(stream){ stream.getTracks().forEach(t=>t.stop()); stream=null; }
    v.pause(); v.srcObject=null; curTrack=null; torchOn=false; document.getElementById('torch').disabled = true;
    ctx.clearRect(0,0,bbox.width,bbox.height);
  }

  async function scanLoopBD(){
    if (!det || !v || v.readyState<2){ raf = requestAnimationFrame(scanLoopBD); return; }
    try{
      const codes = await det.detect(v);
      if (codes && codes.length){
        const c = codes[0];
        const now = performance.now();
        if (c.rawValue && (c.rawValue!==lastVal || now-lastTs>1500)){
          lastVal = c.rawValue; lastTs = now; showResult(c.rawValue); beep();
        }
        if (c.cornerPoints){
          // cornerPoints may be DOMPoints; map to x/y
          drawBox(c.cornerPoints.map(p=>({x:p.x, y:p.y})));
        }
      } else {
        ctx.clearRect(0,0,bbox.width,bbox.height);
      }
    }catch{}
    raf = requestAnimationFrame(scanLoopBD);
  }

  function scanLoopJsQR(){
    if (!window.jsQR || !v || v.readyState<2){ raf = requestAnimationFrame(scanLoopJsQR); return; }
    // Draw current frame to a temp canvas the size of video
    if (bbox.width !== v.videoWidth || bbox.height !== v.videoHeight){
      bbox.width = v.videoWidth; bbox.height = v.videoHeight;
    }
    ctx.drawImage(v, 0, 0, bbox.width, bbox.height);
    try{
      const frame = ctx.getImageData(0,0,bbox.width,bbox.height);
      const qr = window.jsQR(frame.data, frame.width, frame.height, { inversionAttempts: "attemptBoth" });
      if (qr){
        const now = performance.now();
        if (qr.data && (qr.data!==lastVal || now-lastTs>1500)){
          lastVal = qr.data; lastTs = now; showResult(qr.data); beep();
        }
        if (qr.location){
          const p = qr.location;
          drawBox([{x:p.topLeftCorner.x,y:p.topLeftCorner.y},{x:p.topRightCorner.x,y:p.topRightCorner.y},{x:p.bottomRightCorner.x,y:p.bottomRightCorner.y},{x:p.bottomLeftCorner.x,y:p.bottomLeftCorner.y}]);
        }
      } else {
        ctx.clearRect(0,0,bbox.width,bbox.height);
      }
    }catch{}
    raf = requestAnimationFrame(scanLoopJsQR);
  }

  // Image upload
  document.getElementById('file').addEventListener('change', async (e)=>{
    const f = e.target.files[0]; if (!f) return;
    const img = new Image(); img.onload = async ()=>{
      bbox.width = img.width; bbox.height = img.height; ctx.drawImage(img,0,0);
      try{
        if (!usingJsQR && det && det.detect){
          const c = document.createElement('canvas'); c.width=img.width; c.height=img.height; c.getContext('2d').drawImage(img,0,0);
          const r = await det.detect(c);
          if (r && r.length){ showResult(r[0].rawValue); drawBox(r[0].cornerPoints?.map(p=>({x:p.x,y:p.y}))); return; }
        }
        // fallback jsQR
        await ensureJsQR();
        const frame = ctx.getImageData(0,0,bbox.width,bbox.height);
        const qr = window.jsQR(frame.data, frame.width, frame.height);
        if (qr){ showResult(qr.data); const p = qr.location;
          drawBox([{x:p.topLeftCorner.x,y:p.topLeftCorner.y},{x:p.topRightCorner.x,y:p.topRightCorner.y},{x:p.bottomRightCorner.x,y:p.bottomRightCorner.y},{x:p.bottomLeftCorner.x,y:p.bottomLeftCorner.y}]); }
        else { showResult((I18N[document.getElementById('lang').value]||I18N.en).noqr); }
      }catch{ showResult('Decode failed.'); }
    };
    img.src = URL.createObjectURL(f);
  });

  // Torch toggle (if supported)
  document.getElementById('torch').addEventListener('click', async ()=>{
    if (!curTrack || !curTrack.getCapabilities) return;
    const caps = curTrack.getCapabilities();
    if (!caps.torch) return;
    torchOn = !torchOn;
    try{ await curTrack.applyConstraints({ advanced: [{ torch: torchOn }] }); }catch{}
  });

  // Buttons
  document.getElementById('start').onclick = startCam;
  document.getElementById('stop').onclick  = stopCam;
  document.getElementById('copy').onclick  = ()=>{
    const t = res.textContent||''; if (!t || t==='‚Äî') return;
    navigator.clipboard?.writeText(t).then(()=>{
      statusEl.textContent = (I18N[document.getElementById('lang').value]||I18N.en).copied;
    }).catch(()=>{
      statusEl.textContent = (I18N[document.getElementById('lang').value]||I18N.en).copyfail;
    });
  };
  document.getElementById('cams').addEventListener('change', startCam);
  window.addEventListener('beforeunload', stopCam);

  // Auto start if ?auto=1
  if (qs.get('auto')==='1'){ startCam(); }
</script>

<!-- ‰øùÁïô‰Ω†ÁöÑ Home ÈìæÊé•ËØ≠Ë®ÄÈÄè‰º†ÈÄªËæë -->
<script>
(function(){
  var path = location.pathname.replace(/\/+$/,'');
  var parts = path.split('/');
  if (parts.length >= 3) parts = parts.slice(0, parts.length - 2);
  else parts = [''];
  var home = parts.join('/') + '/';

  var cur = new URL(location.href);
  var lang = cur.searchParams.get('lang');
  if (lang) {
    var u = new URL(home, location.origin);
    u.searchParams.set('lang', lang);
    home = u.pathname + u.search + u.hash;
  }
  document.querySelectorAll('a[data-home]').forEach(function(a){
    a.setAttribute('href', home);
  });
})();
</script>
</body>
</html>
